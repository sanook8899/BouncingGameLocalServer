const Websocket = require("ws");

const server = new Websocket.Server({ port: 9900 });

let wsocket; // Declare a variable to hold the WebSocket object

var balance = 0;
var playerId = "";
var increaseMoney = 0;
var gameCode = "";
var awardMoney = 0;
var awardBase = 0;
var gameType = 2;
var roomId = 0;
var records = [];
var savedRecords = []; // New array to store records with distribution control
var multiplierValue = [2, 1, 0.5, 1, 2];
var winIndex = [0, 1, 2, 3, 4, 5];
var winMultiplierValue = [
  [
    [
      1.58, 1.78, 2, 2.52, 2.9, 3, 3.8, 3.84, 3.94, 4, 4.4, 4.55, 4.96, 5, 5.14, 5.32, 5.6, 6, 6.5, 6.52, 6.8, 7, 7.15, 7.36, 7.7, 7.88, 8, 8.4, 8.85, 9, 9.04, 9.2, 9.4, 9.88, 9.9, 10, 10.4, 10.6, 10.8, 11, 11.6, 11.8, 11.84, 12, 12.4, 12.5, 12.6, 13, 13.4, 14, 14.2, 14.8, 15, 15.4, 15.8, 16, 16.4, 17, 17.4, 17.6, 18, 18.2, 18.6, 19, 19.2, 19.4, 19.5, 19.6, 19.8, 20, 20.4, 20.46, 20.5, 20.6, 21, 21.6, 22, 22.4, 23, 23.4, 23.6, 24, 25, 25.8, 26, 26.2, 27, 27.5, 28, 28.4, 29, 30, 30.2, 30.6, 31,
      32, 33, 34, 35, 36, 36.8, 37, 38, 40, 41, 41.5, 42, 43, 43.5, 44, 45, 46, 47, 47.5, 48, 49.5, 50, 51, 52, 53, 54, 55, 55.25, 56.5, 59, 60, 62, 63, 64, 66, 67, 68.5, 70, 72, 73, 74, 75, 77, 80, 82, 85, 86, 87, 88, 91, 93, 100, 103, 113, 114,
    ],
    [
      0.25, 0.28, 0.32, 0.33, 0.35, 0.36, 0.37, 0.38, 0.39, 0.4, 0.41, 0.43, 0.44, 0.48, 0.49, 0.5, 0.51, 0.52, 0.54, 0.55, 0.56, 0.57, 0.58, 0.59, 0.62, 0.63, 0.64, 0.66, 0.67, 0.68, 0.69, 0.7, 0.71, 0.72, 0.76, 0.78, 0.8, 0.82, 0.84, 0.85, 0.87, 0.88, 0.89, 0.91, 0.92, 0.93, 0.95, 0.97, 0.98, 0.99, 1.25, 1.28, 1.35, 1.42, 1.5, 1.51, 1.53, 1.85, 2, 2.01, 2.02, 2.07, 2.1, 2.31, 2.48, 2.49, 2.51, 2.52, 2.59, 2.65, 2.78, 3.25, 3.42, 3.62, 3.7, 3.89, 4.24, 4.32, 4.52, 4.59, 4.61, 4.66, 4.7, 4.74,
      4.75, 5.01, 5.03, 5.15, 5.32, 5.76, 6.64, 6.8, 6.92, 6.93, 7.11, 7.15, 8.02, 8.96, 9.86, 9.98, 10, 10.2, 10.36, 10.6, 11, 11.4, 11.5, 11.68, 12, 13, 13.7, 14.1, 15.5, 15.6, 15.9, 16.38, 17, 18.2, 18.4, 21.8, 24.8, 26, 28, 29, 31.5, 34, 35, 40, 45, 47, 50, 53, 55, 57, 58, 60, 60.5, 63, 64, 65, 66, 68, 72, 73, 78, 81, 86, 89, 92, 100,
    ],
    [
      0, 0.03, 0.04, 0.05, 0.06, 0.07, 0.1, 0.16, 0.17, 0.2, 0.22, 0.23, 0.25, 0.26, 0.27, 0.28, 0.32, 0.34, 0.37, 0.41, 0.42, 0.45, 0.5, 0.51, 0.52, 0.53, 0.54, 0.55, 0.56, 0.6, 0.64, 0.65, 0.67, 0.68, 0.69, 0.7, 0.71, 0.72, 0.73, 0.75, 0.76, 0.77, 0.78, 0.8, 0.84, 0.85, 0.86, 0.89, 0.91, 0.94, 1.15, 1.16, 1.38, 1.82, 1.86, 2.16, 2.37, 2.47, 2.8, 2.85, 2.87, 3.04, 3.05, 3.19, 3.34, 3.55, 4, 4.05, 4.25, 4.28, 4.7, 4.75, 4.88, 4.99, 5.09, 5.24, 5.44, 5.49, 5.75, 5.82, 5.88, 6, 6.27, 6.37, 7,
      7.05, 7.15, 7.25, 7.33, 7.51, 7.54, 7.69, 8.33, 8.38, 8.47, 8.74, 9, 9.07, 9.88, 9.93, 11.05, 11.32, 11.46, 11.75, 11.85, 12.32, 12.38, 12.5, 13.13, 13.86, 14.82, 14.9, 15.34, 16.75, 16.99, 17, 17.64, 17.88, 18.4, 20, 23, 25, 28, 28.5, 29, 29.4, 30, 30.5, 37, 37.5, 50, 50.5, 51, 53, 56, 56.5, 57, 58.5, 60, 61, 62, 64, 66, 68, 75, 89, 100, 105, 118, 143,
    ],
    [
      0.22, 0.27, 0.28, 0.31, 0.33, 0.35, 0.37, 0.38, 0.42, 0.44, 0.45, 0.47, 0.48, 0.49, 0.5, 0.51, 0.52, 0.53, 0.54, 0.56, 0.59, 0.6, 0.61, 0.62, 0.63, 0.64, 0.65, 0.66, 0.67, 0.68, 0.7, 0.71, 0.75, 0.77, 0.79, 0.81, 0.82, 0.83, 0.84, 0.85, 0.86, 0.87, 0.88, 0.9, 0.91, 0.92, 0.93, 0.94, 0.95, 0.97, 1.02, 1.09, 1.15, 1.22, 1.26, 1.65, 1.87, 1.9, 1.92, 2.03, 2.06, 2.25, 2.26, 2.51, 2.54, 2.69, 2.7, 3, 3.35, 3.47, 3.91, 3.93, 4.09, 5.1, 5.25, 5.46, 5.63, 5.84, 5.99, 6.38, 6.44, 6.82, 7.63, 7.66,
      7.82, 8.17, 8.43, 8.52, 8.55, 8.7, 8.75, 8.8, 9.25, 9.38, 9.59, 9.72, 9.75, 9.82, 9.85, 9.98, 10.74, 11.3, 11.5, 11.59, 11.99, 12.2, 13.03, 14.63, 14.64, 14.75, 16.1, 16.65, 16.91, 17.17, 17.36, 17.75, 20, 20.7, 20.8, 21.53, 23.75, 24, 24.35, 26.79, 27.75, 29.5, 31, 34.5, 44, 44.4, 51.5, 53.5, 53.75, 55, 56, 60, 61.5, 64, 71, 75, 75.5, 77, 82, 86, 93, 108, 109, 110, 111, 112,
    ],
    [
      0, 0.01, 0.02, 0.03, 0.05, 0.07, 0.13, 0.16, 0.2, 0.21, 0.22, 0.24, 0.26, 0.27, 0.3, 0.37, 0.4, 0.41, 0.45, 0.46, 0.48, 0.5, 0.53, 0.54, 0.56, 0.59, 0.6, 0.61, 0.62, 0.63, 0.65, 0.67, 0.68, 0.69, 0.71, 0.72, 0.73, 0.75, 0.76, 0.77, 0.82, 0.88, 0.89, 0.91, 0.92, 0.93, 0.94, 0.95, 0.96, 0.97, 1.15, 1.33, 1.41, 1.57, 1.59, 1.6, 1.64, 1.67, 1.75, 1.76, 1.77, 1.95, 2, 2.01, 2.03, 2.65, 2.71, 2.8, 2.99, 3.01, 3.03, 3.35, 3.38, 3.4, 3.44, 3.58, 3.83, 3.88, 4.13, 4.16, 4.25, 4.39, 5.25, 5.4, 5.56,
      5.57, 5.63, 6, 6.13, 6.25, 7.13, 7.5, 8.32, 8.57, 8.76, 8.8, 9.01, 9.02, 9.11, 9.88, 10.3, 10.79, 10.94, 11.12, 11.58, 11.63, 11.75, 12.33, 12.5, 13.31, 14.1, 14.21, 14.91, 14.92, 15.25, 15.5, 17.5, 18.35, 20.43, 20.75, 21.54, 21.94, 22, 22.15, 22.94, 23, 26.82, 30.4, 33, 38.07, 50, 50.5, 51, 52, 53.5, 54, 54.8, 55, 55.5, 56, 58.5, 59, 65, 65.75, 68, 71, 80, 93, 96, 108,
    ],
    [
      0.12, 0.2, 0.21, 0.24, 0.25, 0.26, 0.27, 0.28, 0.29, 0.3, 0.31, 0.32, 0.33, 0.34, 0.35, 0.36, 0.38, 0.4, 0.42, 0.45, 0.46, 0.47, 0.48, 0.49, 0.5, 0.51, 0.52, 0.53, 0.54, 0.55, 0.58, 0.59, 0.6, 0.62, 0.63, 0.64, 0.65, 0.67, 0.69, 0.7, 0.74, 0.81, 0.82, 0.83, 0.86, 0.89, 0.92, 0.93, 0.95, 0.96, 1, 1.26, 1.27, 1.9, 2.05, 2.16, 2.26, 2.33, 2.48, 2.5, 2.53, 2.54, 2.58, 2.6, 2.63, 2.64, 2.65, 2.71, 2.84, 2.98, 3.02, 3.2, 3.6, 3.62, 3.63, 3.65, 3.92, 4.3, 4.63, 4.76, 5.04, 5.08, 5.2, 5.48, 5.52,
      5.65, 5.9, 5.95, 6.12, 6.4, 6.5, 6.55, 7.14, 7.23, 7.25, 7.31, 7.35, 7.4, 7.54, 8.5, 10.2, 10.32, 10.5, 10.75, 12, 12.2, 12.83, 13.2, 13.6, 14, 14.13, 14.2, 15.2, 15.6, 15.8, 17, 17.5, 17.88, 18.2, 19, 20, 21.5, 24, 26.25, 27.2, 28, 29, 30.5, 41.5, 45.5, 52, 53, 54, 55, 56, 59, 62, 64, 65, 66, 68, 72, 76, 77, 88, 92, 101, 109, 117, 122,
    ],
  ],
  [
    [
      0.01, 0.03, 0.04, 0.05, 0.07, 0.09, 0.13, 0.14, 0.15, 0.16, 0.18, 0.22, 0.23, 0.25, 0.26, 0.27, 0.28, 0.29, 0.3, 0.31, 0.32, 0.34, 0.35, 0.36, 0.38, 0.4, 0.41, 0.42, 0.43, 0.44, 0.45, 0.46, 0.5, 0.51, 0.54, 0.58, 0.6, 0.65, 0.69, 0.74, 0.75, 0.76, 0.79, 0.83, 0.9, 0.92, 0.93, 0.95, 0.96, 0.98, 1.06, 1.08, 1.29, 1.3, 1.31, 1.32, 1.38, 1.39, 1.57, 1.67, 1.68, 1.8, 2.11, 2.49, 2.58, 2.84, 2.88, 2.9, 3.24, 3.6, 3.68, 4, 4.04, 4.16, 4.4, 4.75, 4.79, 5, 5.08, 5.4, 5.41, 5.6, 5.66, 6, 6.26, 6.29,
      6.39, 6.4, 6.55, 6.6, 7, 7.4, 7.44, 7.6, 7.76, 8.4, 8.8, 9, 9.26, 9.94, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 26, 26.84, 27, 29, 30, 31, 32, 33, 34, 36, 37, 42, 43, 45, 46, 49, 55, 56, 60, 63, 68, 73, 77, 77.2, 79, 86, 87, 92, 95, 101, 103, 109, 116, 128, 137, 138,
    ],
    [
      0, 0.01, 0.02, 0.03, 0.05, 0.06, 0.07, 0.12, 0.13, 0.14, 0.17, 0.19, 0.2, 0.21, 0.22, 0.23, 0.25, 0.26, 0.27, 0.28, 0.29, 0.3, 0.31, 0.32, 0.33, 0.34, 0.38, 0.39, 0.4, 0.41, 0.47, 0.48, 0.49, 0.52, 0.55, 0.58, 0.59, 0.71, 0.74, 0.75, 0.79, 0.82, 0.83, 0.85, 0.86, 0.88, 0.89, 0.91, 0.95, 0.98, 1.04, 1.24, 1.25, 1.26, 1.29, 1.56, 1.86, 1.87, 1.93, 1.94, 2.05, 2.12, 2.39, 2.43, 2.49, 2.58, 2.7, 3.92, 4.48, 5.02, 5.38, 5.4, 5.45, 5.48, 5.8, 5.92, 6.07, 6.25, 6.28, 6.29, 6.3, 6.32, 6.34, 6.37,
      6.43, 6.46, 6.49, 6.76, 7.02, 7.4, 7.6, 7.68, 7.92, 8.2, 9, 9.28, 9.32, 9.36, 9.4, 9.76, 10.08, 12, 12.4, 13.38, 14, 14.4, 14.88, 15, 15.6, 15.98, 17.4, 19, 19.2, 19.6, 20.44, 20.6, 20.65, 22.2, 22.32, 22.4, 22.68, 31, 33, 33.4, 36, 41, 44, 44.2, 47, 49, 50, 51, 51.4, 52, 55, 57, 59, 64, 70, 73, 76, 82, 84, 86, 87, 91, 96, 100, 110, 118,
    ],
    [
      0, 0.01, 0.02, 0.03, 0.04, 0.05, 0.07, 0.13, 0.16, 0.17, 0.21, 0.23, 0.25, 0.26, 0.27, 0.28, 0.29, 0.3, 0.31, 0.32, 0.33, 0.35, 0.36, 0.37, 0.38, 0.4, 0.41, 0.43, 0.45, 0.46, 0.48, 0.53, 0.54, 0.55, 0.61, 0.67, 0.68, 0.73, 0.74, 0.75, 0.76, 0.78, 0.81, 0.82, 0.87, 0.9, 0.93, 0.95, 0.98, 0.99, 1, 1.13, 1.24, 1.27, 1.35, 1.49, 1.58, 1.7, 1.86, 1.9, 1.94, 2.04, 2.08, 2.26, 2.28, 2.35, 2.48, 2.5, 2.59, 2.92, 3, 3.71, 3.84, 3.99, 4.07, 4.11, 4.23, 4.36, 4.4, 4.44, 4.52, 4.9, 5.29, 5.31, 5.32,
      5.47, 5.72, 6.04, 6.12, 6.15, 6.28, 6.29, 6.92, 7, 7.24, 7.4, 7.56, 7.66, 7.7, 9.48, 10.2, 10.36, 11.86, 11.9, 12.4, 12.8, 12.91, 13.4, 15, 16, 16.2, 16.4, 16.6, 17.13, 17.8, 18, 18.2, 18.4, 19.2, 19.8, 21.2, 21.4, 21.75, 22.6, 23.8, 25.4, 30.2, 41.2, 42, 42.16, 50.5, 51.08, 58, 63, 63.44, 65, 69, 70, 74, 75, 76, 77, 78, 83, 86, 91, 116, 123, 128, 178,
    ],
    [
      0.02, 0.03, 0.1, 0.12, 0.18, 0.19, 0.25, 0.26, 0.27, 0.28, 0.29, 0.32, 0.33, 0.35, 0.36, 0.37, 0.38, 0.39, 0.4, 0.41, 0.43, 0.44, 0.45, 0.46, 0.48, 0.51, 0.53, 0.54, 0.57, 0.58, 0.6, 0.61, 0.64, 0.68, 0.69, 0.7, 0.71, 0.73, 0.75, 0.76, 0.77, 0.85, 0.86, 0.89, 0.9, 0.93, 0.96, 0.97, 0.98, 0.99, 1.01, 1.12, 1.19, 1.39, 1.47, 1.5, 1.51, 1.75, 1.88, 1.93, 2.09, 2.17, 2.35, 2.65, 2.73, 2.76, 2.89, 3.02, 3.24, 3.44, 3.53, 3.66, 3.71, 3.74, 3.85, 3.9, 4.06, 4.63, 4.91, 4.95, 5.16, 5.27, 5.48,
      5.5, 5.64, 5.66, 5.76, 5.88, 6, 6.5, 7.11, 7.17, 7.26, 7.75, 7.76, 8.04, 8.58, 9.44, 9.46, 9.76, 10.22, 10.59, 10.77, 12.6, 13, 14.67, 14.75, 16.75, 16.76, 17.4, 17.8, 19.52, 20.45, 21.6, 23.6, 26.04, 27.13, 29.6, 30.44, 31.42, 34.41, 35.07, 36.45, 37.43, 38, 38.2, 38.21, 39.69, 40.2, 40.46, 52.66, 57, 58, 66, 69, 72, 79.52, 83, 89, 102, 105, 106, 112, 120, 155, 157, 178, 210, 212, 218,
    ],
    [
      0.05, 0.06, 0.08, 0.1, 0.11, 0.14, 0.17, 0.18, 0.21, 0.24, 0.26, 0.27, 0.29, 0.32, 0.33, 0.35, 0.36, 0.38, 0.4, 0.41, 0.42, 0.43, 0.44, 0.45, 0.48, 0.49, 0.5, 0.51, 0.52, 0.53, 0.55, 0.56, 0.59, 0.62, 0.66, 0.67, 0.71, 0.74, 0.78, 0.8, 0.81, 0.82, 0.89, 0.9, 0.92, 0.93, 0.94, 0.95, 0.96, 0.97, 1, 1.11, 1.35, 1.46, 1.52, 1.61, 1.63, 1.65, 1.7, 1.75, 1.78, 1.81, 1.9, 2.05, 2.09, 2.11, 2.21, 2.22, 2.43, 2.62, 2.88, 3.01, 3.05, 3.08, 3.27, 3.3, 3.48, 3.51, 3.68, 3.84, 4.28, 4.5, 5.23, 5.28,
      5.59, 5.63, 5.72, 5.75, 5.76, 6.28, 7.53, 7.57, 8.15, 8.23, 8.79, 8.84, 9.18, 9.23, 9.69, 9.8, 10.01, 10.03, 10.17, 10.21, 11.6, 11.84, 13.17, 13.6, 14.8, 16.2, 16.99, 18.02, 18.2, 18.28, 18.4, 19, 19.38, 20, 20.75, 22.85, 23, 24.88, 25.32, 26.6, 27.74, 29, 31.2, 32.4, 33.05, 33.24, 52, 59, 61.6, 62, 68, 72.4, 77, 79, 83, 85, 87, 95, 116, 120, 126, 131, 163, 166, 179, 204,
    ],
    [
      0, 0.02, 0.05, 0.1, 0.14, 0.17, 0.26, 0.31, 0.38, 0.39, 0.4, 0.41, 0.42, 0.48, 0.49, 0.5, 0.51, 0.53, 0.54, 0.55, 0.56, 0.57, 0.58, 0.6, 0.61, 0.62, 0.63, 0.64, 0.65, 0.67, 0.68, 0.69, 0.7, 0.71, 0.73, 0.74, 0.75, 0.78, 0.8, 0.81, 0.82, 0.83, 0.87, 0.88, 0.89, 0.9, 0.92, 0.93, 0.94, 0.95, 1.08, 1.17, 1.18, 1.21, 1.35, 1.45, 1.6, 1.61, 1.92, 2.04, 2.1, 2.11, 2.18, 2.93, 3.24, 3.29, 3.41, 3.8, 3.85, 3.9, 4.15, 4.18, 4.32, 4.4, 4.61, 4.84, 5.01, 5.28, 5.38, 5.41, 5.6, 5.75, 6.04, 6.28, 6.32,
      6.36, 6.44, 6.5, 6.6, 7.22, 7.24, 7.28, 7.52, 8, 8.2, 8.44, 8.56, 8.68, 8.8, 8.96, 11, 11.08, 11.78, 12.4, 13.2, 17, 18.6, 18.8, 19.6, 20.4, 22.4, 23.8, 24, 25, 25.4, 25.6, 29.17, 30.4, 31.4, 34.4, 39, 39.18, 39.51, 42, 44, 46, 47.2, 47.37, 48, 49, 50.4, 55, 64, 78, 83, 87, 90, 92, 98, 102, 103, 112, 117, 120, 122, 138, 148, 153, 160, 215,
    ],
  ],
  [
    [
      5, 5.08, 6, 11.5, 12, 14, 15, 16, 18, 21, 22, 23, 24, 24.88, 25, 26, 28.8, 29.28, 30, 30.64, 31, 32, 32.2, 32.8, 33, 35, 36, 38.46, 38.75, 39, 39.2, 40, 41, 42, 43, 44, 44.09, 45.09, 46.2, 47, 47.71, 49, 50, 52.16, 53, 54.04, 56, 57.4, 57.75, 59.81, 63, 64.16, 64.8, 65.8, 66.96, 67.07, 69.6, 70.4, 70.8, 78.4, 78.75, 80.04, 81, 84.86, 86.55, 86.6, 87.96, 88.75, 89, 89.4, 92, 95.24, 95.56, 96.6, 98.81, 103, 103.32, 103.52, 104.4, 105.12, 105.6, 108.6, 109.2, 109.74, 111.8, 114.6, 116, 117,
      117.88, 119.41, 119.74, 127.69, 129, 129.94, 131.6, 132.12, 132.2, 134, 134.8, 137.56, 138.34, 138.75, 140.24, 142, 143.6, 143.72, 144.44, 145.28, 148, 149.57, 150, 156.6, 157.46, 158.4, 162.29, 165, 165.4, 166, 170, 176, 177.6, 178, 181.72, 184.6, 186, 196, 197, 203, 205, 215, 219, 231, 234, 235, 236, 239, 242, 243, 247, 248, 255, 259, 260, 261, 265, 281, 292, 296, 299, 302,
    ],
    [
      0, 0.01, 0.02, 0.04, 0.05, 0.06, 0.07, 0.08, 0.14, 0.16, 0.17, 0.18, 0.19, 0.2, 0.21, 0.22, 0.23, 0.24, 0.25, 0.26, 0.27, 0.29, 0.3, 0.36, 0.43, 0.44, 0.51, 0.54, 0.61, 0.67, 0.69, 0.73, 0.8, 0.81, 0.82, 0.83, 0.84, 0.85, 0.86, 0.87, 0.88, 0.89, 0.9, 0.92, 0.93, 0.95, 0.96, 0.97, 0.98, 0.99, 1, 1.01, 1.02, 1.03, 1.04, 1.05, 1.07, 1.08, 1.13, 1.18, 1.24, 1.28, 1.29, 1.32, 1.36, 1.4, 1.5, 1.58, 1.88, 2.27, 2.77, 2.79, 2.9, 3, 4.02, 4.12, 4.2, 4.21, 4.23, 4.4, 4.75, 4.85, 4.86, 4.91, 4.97, 5,
      5.01, 5.02, 5.06, 5.08, 5.19, 5.38, 5.53, 5.64, 5.85, 6.2, 6.44, 7.06, 8.98, 9.88, 10.44, 10.5, 11.08, 11.32, 11.64, 12.25, 12.82, 17.04, 17.2, 17.32, 18.04, 18.97, 19.08, 21.78, 24.81, 25.61, 26.5, 27.34, 27.4, 28.4, 28.78, 30.06, 30.44, 30.83, 33.28, 36.2, 40.59, 44.8, 45.04, 48, 54.5, 64.5, 67.11, 125, 130.2, 132.8, 134.39, 153.44, 166.74, 180.68, 183.76, 189.8, 194.8, 199.36, 225.6, 229.69, 254, 257, 287, 295,
    ],
    [
      0, 0.01, 0.04, 0.05, 0.06, 0.1, 0.12, 0.14, 0.15, 0.18, 0.19, 0.2, 0.21, 0.23, 0.24, 0.28, 0.31, 0.36, 0.37, 0.38, 0.39, 0.42, 0.44, 0.46, 0.47, 0.48, 0.49, 0.5, 0.51, 0.52, 0.53, 0.54, 0.6, 0.61, 0.65, 0.66, 0.67, 0.68, 0.7, 0.71, 0.72, 0.73, 0.77, 0.79, 0.81, 0.82, 0.89, 0.9, 0.94, 0.96, 1, 1.01, 1.03, 1.25, 1.32, 1.33, 1.35, 1.41, 1.63, 1.66, 1.7, 1.73, 2.02, 2.2, 2.27, 2.3, 2.48, 2.49, 2.5, 2.6, 2.64, 2.73, 2.78, 2.84, 2.95, 3.01, 3.13, 3.35, 3.4, 3.72, 4.02, 4.22, 4.23, 4.51, 4.61,
      4.88, 4.9, 4.92, 5.3, 6.2, 6.34, 6.65, 7.63, 7.78, 7.82, 8, 9.05, 9.36, 9.8, 9.9, 10.85, 11.21, 11.72, 11.85, 12.41, 12.64, 14.48, 15.96, 16.14, 16.91, 17.4, 18.71, 19, 19.28, 19.3, 19.4, 19.44, 20.1, 21.84, 26.79, 28.17, 30.56, 31.92, 32.21, 35.34, 36.76, 38, 38.17, 38.27, 41.56, 54.27, 55.4, 59, 59.06, 67.05, 70.25, 75.69, 88.81, 89.06, 89.77, 98.4, 103.74, 108.01, 109.32, 110.03, 111.05, 111.48, 158, 186.1, 416,
    ],
    [
      0, 0.01, 0.02, 0.04, 0.05, 0.06, 0.07, 0.1, 0.11, 0.14, 0.16, 0.19, 0.2, 0.21, 0.23, 0.24, 0.25, 0.26, 0.27, 0.3, 0.32, 0.36, 0.37, 0.38, 0.39, 0.4, 0.41, 0.44, 0.45, 0.5, 0.53, 0.55, 0.56, 0.57, 0.58, 0.59, 0.6, 0.61, 0.67, 0.71, 0.72, 0.76, 0.77, 0.81, 0.82, 0.86, 0.89, 0.92, 0.93, 0.96, 1.02, 1.1, 1.18, 1.21, 1.32, 1.5, 1.58, 1.59, 1.78, 1.88, 1.89, 1.94, 1.99, 2.06, 2.07, 2.09, 2.17, 2.68, 2.88, 3.06, 3.17, 3.19, 3.3, 3.31, 3.57, 3.69, 3.8, 4.2, 4.52, 4.78, 4.88, 5.13, 5.69, 5.7, 6.1,
      6.5, 6.57, 6.6, 6.68, 7, 7.15, 7.4, 7.62, 7.72, 7.98, 8.29, 8.44, 8.48, 9.22, 9.32, 12.98, 13.01, 13.89, 14.45, 15, 15.64, 15.76, 16.01, 16.15, 16.2, 17.25, 17.4, 17.6, 18.59, 18.93, 19.76, 20.59, 21.63, 22.08, 26.22, 26.31, 29.31, 30.6, 33.64, 34.18, 34.51, 35.04, 36.38, 45, 48.41, 50.27, 63.21, 65.07, 94.2, 94.99, 95.12, 95.32, 95.51, 96.58, 97.43, 102.5, 110.51, 114.99, 117.52, 124.55, 128, 168.2, 212, 234.2, 295,
    ],
    [
      0, 0.01, 0.02, 0.03, 0.04, 0.05, 0.06, 0.07, 0.08, 0.1, 0.11, 0.12, 0.13, 0.16, 0.17, 0.18, 0.2, 0.21, 0.22, 0.23, 0.24, 0.25, 0.26, 0.28, 0.29, 0.3, 0.31, 0.35, 0.36, 0.37, 0.39, 0.4, 0.41, 0.5, 0.52, 0.6, 0.63, 0.71, 0.81, 0.82, 0.84, 0.85, 0.86, 0.88, 0.92, 0.95, 0.96, 0.97, 0.98, 0.99, 1, 1.01, 1.02, 1.04, 1.1, 1.14, 1.17, 1.18, 1.19, 1.27, 1.28, 1.36, 1.82, 1.94, 2.15, 2.42, 2.73, 2.89, 3.4, 3.84, 4.05, 4.09, 4.7, 4.85, 4.88, 4.96, 5, 5.01, 5.17, 5.23, 5.24, 5.26, 5.29, 5.3, 5.61,
      5.63, 6.12, 6.2, 6.92, 7.09, 7.2, 7.95, 7.96, 8.62, 8.85, 8.86, 8.88, 9.03, 9.15, 9.28, 10.1, 10.22, 10.4, 11.66, 15.76, 16.79, 17.44, 17.63, 18.96, 20.97, 21.56, 22.31, 22.4, 23.82, 23.85, 25.72, 27.3, 27.87, 29.2, 30.14, 33.17, 38.63, 39.08, 41.4, 42.2, 43, 44.44, 45.2, 46.23, 48.8, 54.41, 55.06, 57.4, 57.8, 62.2, 69.4, 70.2, 78, 79, 94.96, 120.5, 133.8, 166, 215, 241, 250, 258, 259, 275, 329,
    ],
    [
      0.01, 0.04, 0.05, 0.07, 0.08, 0.1, 0.12, 0.14, 0.16, 0.17, 0.2, 0.21, 0.24, 0.25, 0.27, 0.28, 0.3, 0.31, 0.35, 0.37, 0.45, 0.46, 0.47, 0.48, 0.49, 0.5, 0.51, 0.52, 0.53, 0.57, 0.63, 0.68, 0.69, 0.76, 0.78, 0.79, 0.81, 0.82, 0.84, 0.85, 0.86, 0.87, 0.88, 0.89, 0.9, 0.92, 0.95, 0.97, 0.98, 0.99, 1, 1.01, 1.04, 1.08, 1.1, 1.21, 1.22, 1.62, 1.65, 1.78, 1.79, 1.8, 1.86, 1.87, 2.12, 2.38, 2.39, 2.58, 2.92, 3.34, 3.39, 4.24, 4.25, 4.99, 5, 5.01, 5.02, 5.03, 5.06, 5.21, 5.25, 5.35, 5.48, 5.74,
      5.85, 5.88, 5.99, 6, 6.01, 6.04, 6.16, 6.21, 6.45, 6.79, 7, 7.68, 7.69, 8.52, 8.91, 9, 10, 10.01, 10.46, 10.86, 12.53, 13, 13.3, 13.45, 14.41, 14.72, 15.48, 16.28, 16.31, 16.64, 17, 18.92, 20.89, 21.27, 21.6, 26.97, 29.75, 31.76, 32.63, 34.68, 35.44, 37.96, 38.8, 43.09, 47.4, 49.9, 63.21, 90.38, 111.08, 113.73, 115.6, 120.4, 121.52, 136, 157, 186, 199.2, 217, 223, 237, 251, 259, 307, 331, 363, 417,
    ],
  ],
];

function generateRandomString(length) {
  const characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
  let randomString = "";

  for (let i = 0; i < length; i++) {
    const randomIndex = Math.floor(Math.random() * characters.length);
    randomString += characters.charAt(randomIndex);
  }

  return randomString;
}

function generateRandomInt(length) {
  const characters = "0123456789";
  let randomString = "";

  for (let i = 0; i < length; i++) {
    const randomIndex = Math.floor(Math.random() * characters.length);
    randomString += characters.charAt(randomIndex);
  }

  return randomString;
}

function loginRequest() {
  playerId = generateRandomString(8);
  balance = 200000;

  let response = {
    errCode: 0,
    errMsg: "success",
    vals: {},
  };

  response.vals = {
    type: 1,
    id: 1,
    data: {
      sessionId: generateRandomInt(10),
      errCode: 0,
      lobbyServerIp: "127.0.0.1",
      lobbyServerPort: 9900,
      playerId: playerId,
    },
  };

  return response;
}

function lobbyRequest() {
  let response = {
    errCode: 0,
    errMsg: "success",
    vals: {},
  };

  response.vals = {
    type: 3,
    id: 3,
    data: {
      gameId: generateRandomInt(6),
      errCode: 0,
      balance: balance,
      serverTime: Date.now(),
      currency: "CNY",
      walletType: 2,
    },
  };
  return response;
}

function joinRoomRequest() {
  let response = {
    errCode: 0,
    errMsg: "success",
    vals: {},
  };

  betInfo = {
    gameName: "Bouncing Ball",
    betSizeList: [1, 4, 16, 64, 256, 1024],
    minBet: 1,
    maxBet: 1024,
    defaultBet: 1,
    decimalCount: false,
  };

  currencyInfo = [
    {
      currencyId: 1,
      currency: "CNY",
    },
  ];

  response.vals = {
    type: 100000,
    id: 3,
    data: {
      subType: 100005,
      subData: [
        {
          gameType: gameType,
          roomId: roomId,
          errCode: 0,
          balance: balance,
          betInfo: [betInfo],
          currencyInfo: currencyInfo,
        },
      ],
    },
  };

  return response;
}

function transferRequest() {
  let response = {
    errCode: 0,
    errMsg: "success",
    vals: {},
  };

  response.vals = {
    type: 100000,
    id: 3,
    data: {
      subType: 100069,
      subData: [
        {
          errCode: 0,
          balance: balance,
          increaseMoney: increaseMoney,
        },
      ],
    },
  };

  increaseMoney = 0;
  return response;
}

function recordRequest() {
  let response = {
    errCode: 0,
    errMsg: "success",
    vals: {},
  };

  records = [
    {
      id: 321541,
      bet: 2,
      odds: 0.0,
      winMoney: 0,
    },
    {
      id: 321541,
      bet: 2,
      odds: 1.5,
      winMoney: 3,
    },
  ];

  response.vals = {
    type: 100000,
    id: 3,
    data: {
      subType: 100071,
      subData: [
        {
          errCode: 0,
          opCode: "GetRecords",
          recordsInfo: records,
        },
      ],
    },
  };

  return response;
}

function roomInfoRequest() {
  let response = {
    errCode: 0,
    errMsg: "success",
    vals: {},
  };

  roomInfo = {
    betOdds: multiplierValue,
    minBet: 1,
    maxBet: 1024,
    recordList: records,
  };

  response.vals = {
    type: 100000,
    id: 3,
    data: {
      subType: 100071,
      subData: [
        {
          errCode: 0,
          opCode: "SyncRoomInfo",
          roomInfo: roomInfo,
        },
      ],
    },
  };

  return response;
}

function roomListRequest() {
  let response = {
    errCode: 0,
    errMsg: "success",
    vals: {},
  };

  let date = Date.now();
  date += 60 * 60 * 1000;
  response.vals = {
    type: 100000,
    id: 3,
    data: {
      gameType: gameType,
      roomIndex: roomId,
      isOccupied: true,
      reserveExpiredTime: date,
    },
  };

  return response;
}

function setBetRequest(bet, level) {
  awardBase = bet;
  gameCode = "#" + generateRandomString(10);
  balance -= awardBase;

  // choose random winMultiplierValue by level
  // level is expected to be 1-based (1,2,3), so adjust for 0-based index
  let winMultipliers = winMultiplierValue[level];

  // Pick a random index from 0 - 5, 0 mean lose
  let selectedWinIndex = Math.floor(Math.random() * winIndex.length);

  let selectedMultiplierArray = winMultipliers[selectedWinIndex];
  let selectedMultiplierIndex = Math.floor(Math.random() * selectedMultiplierArray.length);
  let selectedMultiplier = selectedMultiplierArray[selectedMultiplierIndex];

  let winningBet = 0;
  if (selectedWinIndex != 0) {
    winningBet = bet * multiplierValue[selectedWinIndex - 1];
  }

  let baseOdds = 0;
  if (selectedWinIndex > 0) {
    baseOdds = multiplierValue[selectedWinIndex - 1];
  }

  // Calculate win amount
  let winAmount = selectedMultiplier * bet * baseOdds;

  let response = {
    errCode: 0,
    errMsg: "success",
    vals: {},
  };

  betInfo = [
    {
      bet: awardBase,
      balance: balance,
      index: selectedWinIndex,
      winningBet: winningBet,
      winAmount: winAmount,
      multiplierValue: selectedMultiplier,
      roundId: gameCode,
      finalBalance: balance + winAmount,
    },
  ];
  response.vals = {
    type: 100000,
    id: 3,
    data: {
      subType: 100071,
      subData: [
        {
          errCode: 0,
          opCode: "SetBet",
          betInfo: betInfo,
        },
      ],
    },
  };

  balance += winAmount;

  return response;
}

server.on("connection", (ws) => {
  wsocket = ws;

  // ws.send("4515ce54-c62a-43ed-964e-0f4d4dc402b3");

  ws.on("message", (message) => {
    const jsonContent = JSON.parse(message);

    // login request
    if (jsonContent.type == 0) {
      let response = loginRequest();
      ws.send(JSON.stringify(response));
    }

    // lobby request
    if (jsonContent.type == 2) {
      let response = lobbyRequest();
      ws.send(JSON.stringify(response));
    }

    // room list request
    if (jsonContent.type == 200017) {
      let response = roomListRequest();
      ws.send(JSON.stringify(response));
    }

    if (jsonContent.type == 100000) {
      // join Room request

      if (jsonContent.data[0].subType == 100004) {
        roomId = jsonContent.data[0].subData.roomId;
        let response = joinRoomRequest();
        ws.send(JSON.stringify(response));
      }

      // transfer info request
      if (jsonContent.data[0].subType == 100068) {
        let response = transferRequest();
        ws.send(JSON.stringify(response));
      }

      // custom request
      if (jsonContent.data[0].subType == 100070) {
        // get records request
        if (jsonContent.data[0].subData[0].opCode == "GetRecords") {
          let response = recordRequest();
          ws.send(JSON.stringify(response));
        }
        // sync room info request
        if (jsonContent.data[0].subData[0].opCode == "SyncRoomInfo") {
          let response = roomInfoRequest();
          ws.send(JSON.stringify(response));
        }
        // set bet request
        if (jsonContent.data[0].subData[0].opCode == "SetBet") {
          let bet = jsonContent.data[0].subData[0].message.bet;
          let level = jsonContent.data[0].subData[0].message.level;
          let response = setBetRequest(bet, level);
          ws.send(JSON.stringify(response));
        }
      }
    }
  });
});
